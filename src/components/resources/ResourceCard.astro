---
interface Props {
  href: string;
  title: string;
  description?: string;
  image?: string;
  siteName?: string;
  type?: string;
}

const { href, title, description, image, siteName, type = 'other' } = Astro.props;

const normalizeType = (t: unknown) => String(t || '').toLowerCase().trim();
const typeLabel = (t: unknown) => {
  const kind = normalizeType(t);
  if (!kind || kind === 'other') return 'Resource';
  if (kind === 'library') return 'Library';
  if (kind === 'directory') return 'Directory';
  if (kind === 'tool') return 'Tool';
  if (kind === 'article') return 'Article';
  if (kind === 'video') return 'Video';
  if (kind === 'template') return 'Template';
  if (kind === 'course') return 'Course';
  if (kind === 'podcast') return 'Podcast';
  if (kind === 'newsletter') return 'Newsletter';
  if (kind === 'book') return 'Book';
  return kind.charAt(0).toUpperCase() + kind.slice(1);
};

const searchText = `${title} ${description ?? ''} ${siteName ?? ''} ${href}`
  .toLowerCase()
  .replace(/\s+/g, ' ')
  .trim();

const typeIconPaths = (t: unknown) => {
  const kind = normalizeType(t || 'other');

  // Stroke-only icon paths (stable + consistent rendering)
  if (kind === 'video') {
    return ['M10 8.5v7l6-3.5-6-3.5Z'];
  }

  if (kind === 'article' || kind === 'paper') {
    return ['M8 4h8v16H8z', 'M10 8h4', 'M10 11h4', 'M10 14h3'];
  }

  if (kind === 'tool') {
    return ['M14.7 6.3a3.5 3.5 0 0 1-4.9 4.9L6 15v3h3l3.8-3.8a3.5 3.5 0 0 1 4.9-4.9L16 8l-1.3-1.7Z'];
  }

  if (kind === 'library') {
    // bookshelf
    return ['M5 6h14', 'M5 18h14', 'M7 6v12', 'M11 6v12', 'M15 6v12'];
  }

  if (kind === 'directory') {
    // list
    return ['M7 6h14', 'M7 12h14', 'M7 18h14', 'M3 6h2', 'M3 12h2', 'M3 18h2'];
  }

  if (kind === 'course') {
    // graduation cap
    return ['M22 10L12 5 2 10l10 5 10-5Z', 'M6 12v5c0 1.7 2.7 3 6 3s6-1.3 6-3v-5'];
  }

  if (kind === 'podcast') {
    return ['M12 3a7 7 0 0 0-7 7v3a3 3 0 0 0 3 3h1v-6H8a4 4 0 1 1 8 0h-1v6h1a3 3 0 0 0 3-3v-3a7 7 0 0 0-7-7Z'];
  }

  if (kind === 'newsletter') {
    return ['M4 4h16v16H4z', 'm4 7 8 5 8-5'];
  }

  if (kind === 'book') {
    return ['M6 4h12v16H6z', 'M10 4v16'];
  }

  if (kind === 'template') {
    return ['M4 4h16v16H4z', 'M4 9h16', 'M9 9v11'];
  }

  // other
  return ['M6 8h12', 'M6 12h12', 'M6 16h9'];
};
---

<a
  href={href}
  target="_blank"
  rel="noopener noreferrer"
  data-resource-card
  data-search={searchText}
  class="group block break-inside-avoid rounded-2xl border border-white/10 bg-white/[0.03] overflow-hidden transition-all hover:bg-white/[0.05] hover:border-white/20 focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/20"
>
  {image ? (
    <div class="aspect-video overflow-hidden bg-white/5">
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
        decoding="async"
        referrerpolicy="no-referrer"
      />
    </div>
  ) : null}

  <div class="p-4">
    <div class="flex items-center justify-between gap-3 text-xs text-white/50">
      <div class="flex items-center gap-2 min-w-0">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-white/60"
          aria-hidden="true"
        >
          {typeIconPaths(type).map((d) => (
            <path d={d} />
          ))}
        </svg>
        <span class="truncate">{siteName ?? 'Resource'}</span>
      </div>
      <span class="uppercase tracking-wide text-white/40">{typeLabel(type)}</span>
    </div>

    <h3 class="mt-2 text-sm sm:text-base font-semibold text-white/92 group-hover:text-primary transition-colors line-clamp-2">
      {title}
    </h3>

    {description ? (
      <p class="mt-2 text-sm text-white/70 line-clamp-2">{description}</p>
    ) : null}
  </div>
</a>
