---
interface Props {
  href: string;
  title: string;
  description?: string;
  image?: string;
  siteName?: string;
  type?: string;
}

const { href, title, description, image, siteName, type = 'other' } = Astro.props;

const searchText = `${title} ${description ?? ''} ${siteName ?? ''} ${href}`
  .toLowerCase()
  .replace(/\s+/g, ' ')
  .trim();

const typeIcon = (t: string) => {
  const kind = String(t || 'other').toLowerCase();

  // Simple inline icons (no dependency).
  if (kind === 'video') {
    return '<path d="M10 8.5v7l6-3.5-6-3.5Z"/>';
  }

  if (kind === 'article' || kind === 'paper') {
    return '<path d="M8 4h8v16H8z"/><path d="M10 8h4"/><path d="M10 11h4"/><path d="M10 14h3"/>';
  }

  if (kind === 'tool') {
    return '<path d="M14.7 6.3a3.5 3.5 0 0 1-4.9 4.9L6 15v3h3l3.8-3.8a3.5 3.5 0 0 1 4.9-4.9L16 8l-1.3-1.7Z"/>';
  }

  if (kind === 'repo') {
    return '<path d="M16 18v-2a4 4 0 0 0-1-2.5"/><path d="M8 13.5A4 4 0 0 0 7 16v2"/><path d="M9 18h6"/><path d="M9 6h6"/><path d="M12 6v12"/>';
  }

  if (kind === 'podcast') {
    return '<path d="M12 3a7 7 0 0 0-7 7v3a3 3 0 0 0 3 3h1v-6H8a4 4 0 1 1 8 0h-1v6h1a3 3 0 0 0 3-3v-3a7 7 0 0 0-7-7Z"/>';
  }

  if (kind === 'template') {
    return '<path d="M4 4h16v16H4z"/><path d="M4 9h16"/><path d="M9 9v11"/>';
  }

  return '<path d="M6 8h12"/><path d="M6 12h12"/><path d="M6 16h9"/>';
};
---

<a
  href={href}
  target="_blank"
  rel="noopener noreferrer"
  data-resource-card
  data-search={searchText}
  class="group block rounded-2xl border border-white/10 bg-white/[0.03] overflow-hidden transition-all hover:bg-white/[0.05] hover:border-white/20 focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/20"
>
  {image ? (
    <div class="aspect-video overflow-hidden bg-white/5">
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
        decoding="async"
        referrerpolicy="no-referrer"
      />
    </div>
  ) : null}

  <div class="p-4">
    <div class="flex items-center justify-between gap-3 text-xs text-white/50">
      <div class="flex items-center gap-2 min-w-0">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-white/60"
          aria-hidden="true"
        >
          <Fragment set:html={typeIcon(type)} />
        </svg>
        <span class="truncate">{siteName ?? 'Resource'}</span>
      </div>
      <span class="uppercase tracking-wide text-white/40">{type}</span>
    </div>

    <h3 class="mt-2 text-sm sm:text-base font-semibold text-white/92 group-hover:text-primary transition-colors line-clamp-2">
      {title}
    </h3>

    {description ? (
      <p class="mt-2 text-sm text-white/70 line-clamp-2">{description}</p>
    ) : null}
  </div>
</a>
