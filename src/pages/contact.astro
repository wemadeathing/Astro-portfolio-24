---
import Layout from '../layouts/Layout.astro';

const emailAddress = 'hello@nasifsalaam.com';
const whatsappHref =
  "https://wa.me/0814623628?text=Hi!%20I%27d%20like%20to%20discuss%20a%20project%20with%20you.";
---

<Layout 
  title="Contact | Hire a Technical Product Designer"
  description="Looking for a technical product designer who codes? Available for design systems, AI integration, rapid prototyping, and full-stack development projects."
>
  <section class="py-10 sm:py-14">
    <div class="container max-w-[1100px] mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-2xl mx-auto">
        <h1 class="type-h1 text-white/95">Get in touch</h1>
        <p class="mt-4 type-lead text-white/70">
          Have a project in mind? Send a note and I’ll reply with next steps.
        </p>

        <div class="mt-10">
        <form
          id="contact-form"
          class="rounded-2xl border border-white/10 bg-white/[0.03] p-6 sm:p-7 space-y-5"
          method="POST"
          aria-label="Contact form"
        >
          <!-- Honeypot (spam protection) -->
          <div class="hidden" aria-hidden="true">
            <label for="company">Company</label>
            <input id="company" name="company" type="text" tabindex="-1" autocomplete="off" />
          </div>

          <div>
            <label for="name" class="block text-sm font-medium text-white/85 mb-2">
              Name
            </label>
            <input
              type="text"
              id="name"
              name="name"
              autocomplete="name"
              placeholder="Your name"
              class="w-full rounded-xl bg-[#131313]/60 border border-white/10 px-4 py-3 text-white/90 placeholder:text-white/40 focus:border-primary/70 focus:outline-none focus:ring-4 focus:ring-primary/15 transition-colors"
              required
            />
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-white/85 mb-2">
              Email
            </label>
            <input
              type="email"
              id="email"
              name="email"
              autocomplete="email"
              inputmode="email"
              placeholder="you@company.com"
              class="w-full rounded-xl bg-[#131313]/60 border border-white/10 px-4 py-3 text-white/90 placeholder:text-white/40 focus:border-primary/70 focus:outline-none focus:ring-4 focus:ring-primary/15 transition-colors"
              required
            />
          </div>

          <div>
            <label for="message" class="block text-sm font-medium text-white/85 mb-2">
              Message
            </label>
            <textarea
              id="message"
              name="message"
              rows="7"
              placeholder="A quick outline of what you’re building, timelines, and what you need help with."
              class="w-full rounded-xl bg-[#131313]/60 border border-white/10 px-4 py-3 text-white/90 placeholder:text-white/40 focus:border-primary/70 focus:outline-none focus:ring-4 focus:ring-primary/15 transition-colors resize-y"
              required
            ></textarea>
          </div>

          <div id="formStatus" class="hidden text-sm" role="status" aria-live="polite" aria-atomic="true">
            <p class="error hidden text-destructive">
              <span class="sr-only">Error:</span>
              <span data-error-text>There was an error sending your message. Please try again.</span>
            </p>
            <p class="success hidden text-green-500">
              <span class="sr-only">Success:</span>
              Message sent successfully!
            </p>
            <p class="loading hidden text-primary">
              <span class="sr-only">Loading:</span>
              Sending message...
            </p>
          </div>

          <button
            type="submit"
            id="submitButton"
            class="inline-flex h-12 items-center justify-center rounded-full bg-primary px-8 text-sm font-semibold text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-60 disabled:cursor-not-allowed focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/20"
            aria-describedby="formStatus"
          >
            Send message
          </button>
        </form>

        <div class="mt-6 text-sm text-white/60">
          Prefer direct contact?
        </div>

        <div class="mt-3 flex flex-wrap items-center gap-3">
          <a
            href={`mailto:${emailAddress}?subject=${encodeURIComponent('New project enquiry')}`}
            class="inline-flex h-10 items-center justify-center rounded-full border border-white/15 bg-white/5 px-4 text-xs font-semibold text-white/85 transition-colors hover:bg-white/10 hover:text-white"
          >
            Email
          </a>

          <a
            href={whatsappHref}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex h-10 items-center justify-center rounded-full border border-primary/25 bg-primary/10 px-4 text-xs font-semibold text-white/90 transition-colors hover:bg-primary/15 hover:border-primary/40 focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/20"
          >
            WhatsApp
          </a>

          <a
            class="text-xs text-white/50 hover:text-white/70 transition-colors"
            href={`mailto:${emailAddress}`}
          >
            {emailAddress}
          </a>
        </div>
      </div>
      </div>
    </div>
  </section>
</Layout>

<script is:inline>
  const form = document.getElementById('contact-form');
  const formStatus = document.getElementById('formStatus');
  const errorMessage = formStatus?.querySelector('.error');
  const errorText = errorMessage?.querySelector('[data-error-text]');
  const successMessage = formStatus?.querySelector('.success');
  const loadingMessage = formStatus?.querySelector('.loading');
  const submitButton = document.getElementById('submitButton');

  const setBusy = (busy) => {
    if (submitButton) submitButton.disabled = busy;
    if (form) form.setAttribute('aria-busy', busy ? 'true' : 'false');
  };

  form?.addEventListener('submit', function (e) {
    e.preventDefault();

    // Show loading state
    setBusy(true);
    formStatus?.classList.remove('hidden');
    errorMessage?.classList.add('hidden');
    successMessage?.classList.add('hidden');
    loadingMessage?.classList.remove('hidden');

    const formData = new FormData(form);
    const object = Object.fromEntries(formData);

    fetch('/api/send-email', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
      },
      body: JSON.stringify(object),
    })
      .then(async (response) => {
        const json = await response.json().catch(() => ({}));
        if (response.ok && json.success) {
          window.location.href = '/thank-you';
          return;
        }

        const msg = typeof json?.error === 'string' && json.error.trim().length
          ? json.error
          : 'There was an error sending your message. Please try again.';

        if (errorText) errorText.textContent = msg;

        loadingMessage?.classList.add('hidden');
        errorMessage?.classList.remove('hidden');
      })
      .catch(() => {
        loadingMessage?.classList.add('hidden');
        errorMessage?.classList.remove('hidden');
      })
      .finally(() => {
        setBusy(false);
      });
  });
</script>