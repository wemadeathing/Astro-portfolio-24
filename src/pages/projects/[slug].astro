---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ShareButtons from '../../components/ShareButtons.astro';
import TableOfContents from '../../components/TableOfContents.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props as { project: CollectionEntry<'projects'> };
const { Content } = await project.render();
---

<Layout title={project.data.title}>
  <article class="container max-w-5xl mx-auto px-4 pt-32">
    <div class="lg:grid lg:grid-cols-[1fr_250px] gap-12">
      <div class="max-w-2xl">
        <!-- Header Section -->
        <h1 class="text-4xl font-bold mb-4">{project.data.title}</h1>
        <p class="text-xl text-muted-foreground mb-6">{project.data.description}</p>
        <div class="flex flex-wrap gap-2 mb-8">
          {project.data.tags.map((tag) => (
            <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm">
              {tag}
            </span>
          ))}
        </div>

        <!-- Featured Image -->
        <div class="rounded-xl overflow-hidden mb-12">
          <img
            src={project.data.image}
            alt={project.data.title}
            class="w-full aspect-video object-cover"
          />
        </div>
        
        <ShareButtons title={project.data.title} />
        
        <!-- Content -->
        <div class="prose prose-lg max-w-none mt-12">
          <Content />
        </div>
      </div>
      
      <aside class="hidden lg:block sticky top-24 h-fit max-h-[calc(100vh-6rem)] overflow-y-auto">
        <div class="space-y-8">
          <TableOfContents content={project.body} />
        </div>
      </aside>
    </div>
  </article>
</Layout>

<style is:global>
  .prose {
    @apply text-lg leading-relaxed;
  }

  .prose h2 {
    @apply text-2xl font-semibold mt-12 mb-4;
  }
  
  .prose h3 {
    @apply text-xl font-semibold mt-8 mb-3;
  }

  .prose p {
    @apply mb-6;
  }

  .prose ul {
    @apply my-6 list-none space-y-2;
  }

  .prose ul li {
    @apply flex items-start;
  }

  .prose ul li::before {
    content: "*";
    @apply mr-2 text-primary;
  }

  .prose img {
    @apply rounded-xl my-12;
  }
  
  .prose figure {
    @apply my-12;
  }
  
  .prose figure img {
    @apply my-0;
  }
  
  .prose figcaption {
    @apply text-sm text-muted-foreground text-center mt-4 italic;
  }

  .prose blockquote {
    @apply border-l-4 border-primary/50 pl-6 my-8 italic text-muted-foreground;
  }

  .prose pre {
    @apply bg-secondary/50 backdrop-blur-sm border border-secondary rounded-xl p-6 my-8;
  }

  .prose code {
    @apply text-sm;
  }

  .prose a {
    @apply text-primary hover:underline;
  }
</style>